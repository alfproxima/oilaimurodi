 <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Семейное Дерево</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
        }

        #tree-container {
            width: 100%;
            height: 100vh;
        }

        .node circle {
            fill: #fff;
            stroke: steelblue;
            stroke-width: 3px;
        }

        .node text {
            font: 12px sans-serif;
        }

        .link {
            fill: none;
            stroke: #ccc;
            stroke-width: 2px;
        }

        .male circle {
            fill: #add8e6;
        }

        .female circle {
            fill: #ffb6c1;
        }

        .add-form {
            margin-top: 20px;
        }

        .add-form input, .add-form select, .add-form button {
            padding: 10px;
            margin: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .add-form button {
            background-color: #28a745;
            color: white;
            cursor: pointer;
        }

        .add-form button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>

<h1>Семейное Дерево</h1>

<div id="tree-container"></div>

<div class="add-form">
    <h3>Добавить родственника</h3>
    <input type="text" id="name" placeholder="Имя" />
    <select id="gender">
        <option value="male">Мужчина</option>
        <option value="female">Женщина</option>
    </select>
    <input type="text" id="parentName" placeholder="Имя родителя" />
    <button onclick="addPerson()">Добавить</button>
</div>

<script src="https://d3js.org/d3.v6.min.js"></script>

<script>
    let treeData = {
        name: "Кучак",
        gender: "male",
        children: []
    };

    function updateTree() {
        // Очищаем контейнер для перерисовки
        document.getElementById('tree-container').innerHTML = '';

        const margin = { top: 20, right: 120, bottom: 20, left: 120 },
              width = window.innerWidth - margin.right - margin.left,
              height = window.innerHeight - margin.top - margin.bottom;

        const svg = d3.select("#tree-container").append("svg")
            .attr("width", width + margin.right + margin.left)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        const root = d3.hierarchy(treeData);

        const treeLayout = d3.tree().size([height, width - 160]);

        const nodes = treeLayout(root);

        // Линии (ветви)
        svg.selectAll(".link")
            .data(nodes.links())
          .enter().append("path")
            .attr("class", "link")
            .attr("d", d3.linkVertical()
                .x(d => d.x)
                .y(d => d.y));

        // Узлы (члены семьи)
        const node = svg.selectAll(".node")
            .data(nodes.descendants())
          .enter().append("g")
            .attr("class", d => "node " + (d.data.gender === 'male' ? 'male' : 'female'))
            .attr("transform", d => "translate(" + d.x + "," + d.y + ")");

        node.append("circle")
            .attr("r", 10);

        node.append("text")
            .attr("dy", ".35em")
            .attr("x", d => d.children ? -13 : 13)
            .style("text-anchor", d => d.children ? "end" : "start")
            .text(d => d.data.name);
    }

    function addPerson() {
        const name = document.getElementById('name').value;
        const gender = document.getElementById('gender').value;
        const parentName = document.getElementById('parentName').value;

        if (!name || !parentName) {
            alert('Введите имя и имя родителя!');
            return;
        }

        // Функция поиска родителя по имени
        function findPersonByName(node, name) {
            if (node.name === name) {
                return node;
            } else if (node.children) {
                for (let child of node.children) {
                    let result = findPersonByName(child, name);
                    if (result) return result;
                }
            }
            return null;
        }

        const parent = findPersonByName(treeData, parentName);
        if (parent) {
            if (!parent.children) {
                parent.children = [];
            }
            parent.children.push({
                name: name,
                gender: gender,
                children: []
            });
            updateTree();
        } else {
            alert('Родитель не найден!');
        }

        // Очистка полей
        document.getElementById('name').value = '';
        document.getElementById('parentName').value = '';
    }

    // Инициализация дерева
    updateTree();
</script>

</body>
</html>
